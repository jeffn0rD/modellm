# AGENTS.md

AI coding agent instructions for **modellm**

## Project Overview

**Project Type:** Python Application
**Primary Language:** Python (100% of codebase)

## Key Files

**Documentation:**
- `agents/implementation_guide.md` -- Detailed implementation guide with specifications for tasks
- `doc/workflow_guide.md` -- Usage workflow and examples

**Configuration:**
- `configuration/pipeline_config.yaml` -- Flexible step configuration for prompt pipeline
- `pyproject.toml` -- Updated with prompt-pipeline CLI tool

**Prompt Pipeline Library:**
- `prompt_pipeline/llm_client.py` -- OpenRouter API client
- `prompt_pipeline/prompt_manager.py` -- Prompt loading and step configuration
- `prompt_pipeline/validation/` -- YAML and JSON validators
- `prompt_pipeline/step_executor.py` -- Individual step execution
- `prompt_pipeline/orchestrator.py` -- Pipeline coordination

**CLI Tool:**
- `prompt_pipeline_cli/main.py` -- Main CLI entry point
- `prompt_pipeline_cli/commands/` -- CLI command implementations

**Prompts:**
- `prompts/` -- Prompt templates for pipeline steps (step1, step2, step3, stepC3, stepC4, stepC5, stepD1)

**Agent Tools:**
- `agents/tools/extract_context.py` -- Extract minimal context for a task
- `agents/tools/cli_syntax_checker.py` -- Validate CLI syntax and get hints
- `agents/tools/workflow_guide.md` -- Standardized workflow patterns
- `agents/tools/README.md` -- Tool usage guide
- `agents/context/` -- Generated context files (task-specific)

## Context Management System

### **IMPORTANT: Context Window Guidelines**

The implementation guide (`agents/implementation_guide.md`) is large and can exceed context window limits. **NEVER copy-paste the entire guide**. Instead:

1. **Extract minimal context** before starting each task
2. **Reference the guide by section** (e.g., "See implementation_guide.md section 2.7 for CLI inputs")
3. **Use context files** generated by the tools in `agents/tools/`

### Tool-Based Context Workflow

## Tools Overview

### 1. `extract_context.py`
**Purpose**: Extract only the relevant code needed for a specific task.

**Usage**:
```bash
# Extract a specific function
python agents/tools/extract_context.py \
  --task "Add tag replacement" \
  --files prompt_pipeline/prompt_manager.py:substitute_variables

# Extract multiple files/functions
python agents/tools/extract_context.py \
  --task "Fix validation errors" \
  --files prompt_pipeline/validation/yaml_validator.py:validate \
          prompt_pipeline/step_executor.py:execute_step \
          configuration/pipeline_config.yaml

# Save to file
python agents/tools/extract_context.py \
  --task "Add CLI inputs" \
  --files prompt_pipeline_cli/commands/run_step.py \
          prompt_pipeline_cli/commands/run_pipeline.py \
  --output agents/context/task_123.txt
```

**Features**:
- Extracts specific functions with their imports
- Automatically includes configuration files based on keywords
- Extracts relevant test files
- Creates concise context with clear file boundaries



## Task Management
## Task Creation *IMPORTANT*
- **Keep tasks as narrow as possible** to minimize required context
- **Reason carefully** (ðŸ’¡) taking into account complexity and dependencies
- **It is better to have 30 tasks implementing one function each than 1 task implementing 30 functions**
- **Each task should be a small testable, verifiable, atomic unit** (as practically possible)
- **If scope expands beyond one module or 2-3 functions, verify the plan with the human engineer**
- **Before creating tasks, extract minimal context** using `agents/tools/extract_context.py`

### Before Starting Any Task

**Follow the 3-Step Workflow (see agents/tools/workflow_guide.md for details):**

1. **GET HINTS**: Check syntax before doing anything
   ```bash
   python agents/tools/cli_syntax_checker.py --tool extract_context --examples
   ```

2. **VALIDATE**: Check command syntax (no execution)
   ```bash
   python agents/tools/cli_syntax_checker.py --tool extract_context --validate \
     --task "Your task" --files prompt_pipeline/file.py:function
   ```

3. **EXTRACT**: Get minimal context
   ```bash
   python agents/tools/extract_context.py \
     --task "Your task description" \
     --files prompt_pipeline/specific_file.py:specific_function
   ```

**Additional steps:**
- Review line numbers in the task description
- Check existing code before making changes
- Understand context from extracted context file
- Verify test requirements

### Task Reference System
All implementation tasks are tracked in `.nanocoder/tasks.json` and reference specific sections in `agents/implementation_guide.md`. Each task includes:
- **Priority level**: CRITICAL, HIGH, or MEDIUM
- **File paths**: Exact file locations to modify
- **Line numbers**: Specific line ranges referenced
- **Implementation guide section**: Links to detailed specifications
- **Test requirements**: Detailed test specifications
- **Success criteria**: Clear completion criteria

### During Task Implementation
- Follow the implementation specifications in the guide
- Add type hints to all new functions
- Include comprehensive docstrings
- Write tests BEFORE implementation (TDD approach)
- Use small, focused commits
- Test with the actual TypeDB server when possible

### After Task Completion
- All tests must pass (`pytest tests/ -v`)
- Security tests pass with malicious inputs
- Code coverage > 90% for new code
- No deprecation warnings when running

## Code Style Guidelines
- DO NOT USE inline imports. Imports belong at the top of the module.
- Follow PEP 8 style guide
- Use snake_case for variables and functions
- Use PascalCase for classes
- Include docstrings for functions and classes
- Use type hints where appropriate
- Clean up the directories of test scripts and temporary use tools when tasks are completed.
  - If tools are useful enough to use again save them to the `agents/tools` or `agents/tests` folder.
  - Note unit tests and validations should be saved elsewhere

## Testing
- Unit tests AND integration tests (against test server) are required
- All newly generated code needs to pass all tests before the task can be considered complete

```bash
# Run all tests
pytest tests/ -v

# Run specific test file
pytest tests/test_client.py -v

# Run with coverage
pytest tests/ --cov=tools/typedb_v3_client --cov-report=html

# Run performance benchmarks
pytest tests/performance_tests.py -v --benchmark-only
```

### Task Management
```bash
# View all tasks
list_tasks

# Update task status
update_task --id <task_id> --status in_progress

# Mark task complete
update_task --id <task_id> --status completed
```

## AI Coding Assistance Notes
- The `./agents` folder is for all things to do with LLM agents ONLY; this folder is not for project deliverables
- The `agents/tools/` folder contains helper utilities for context management
- The `agents/context/` folder stores generated context files (automatically created)

**Important Considerations:**
- Check virtual environment setup before running commands
- Be mindful of Python version compatibility
- Follow import organization (stdlib, third-party, local)
- Project has 38 files across 4 directories

---

*This AGENTS.md file was generated by Nanocoder. Update it as your project evolves.*
