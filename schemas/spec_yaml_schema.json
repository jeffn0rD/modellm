{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Specification Schema",
  "type": "object",
  "required": ["specification"],
  "additionalProperties": false,
  "properties": {
    "specification": {
      "type": "object",
      "required": ["id", "title", "version", "description", "metadata", "sections"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^SPEC[0-9]+$"
        },
        "title": {
          "type": "string"
        },
        "version": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "metadata": {
          "type": "object",
          "required": [
            "source_style",
            "intended_use",
            "anchor_id_pattern",
            "section_numbering",
            "concept_assignment_rule"
          ],
          "additionalProperties": false,
          "properties": {
            "source_style": { "type": "string" },
            "intended_use": { "type": "string" },
            "anchor_id_pattern": { "type": "string" },
            "section_numbering": { "type": "string" },
            "concept_assignment_rule": { "type": "string" }
          }
        },
        "sections": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/section" }
        }
      }
    }
  },
  "$defs": {
    "concept": {
      "type": "object",
      "required": ["concept_id", "name", "description"],
      "additionalProperties": false,
      "properties": {
        "concept_id": {
          "type": "string",
          "pattern": "^C[0-9]+$"
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        }
      }
    },
    "text_block": {
      "type": "object",
      "required": ["anchor_id", "label", "type", "semantic_cues", "text", "concepts"],
      "additionalProperties": false,
      "properties": {
        "anchor_id": {
          "type": "string",
          "pattern": "^AN[0-9]+$"
        },
        "label": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": ["goal", "capability", "constraint", "future-capability"]
        },
        "semantic_cues": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string"
          }
        },
        "text": {
          "type": "string"
        },
        "concepts": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/concept" }
        }
      }
    },
    "section": {
      "type": "object",
      "required": ["section_id", "section_number", "order", "title", "label"],
      "additionalProperties": false,
      "properties": {
        "section_id": {
          "type": "string",
          "pattern": "^S[0-9]+$"
        },
        "section_number": {
          "type": "string",
          "pattern": "^[0-9]+(\\.[0-9]+)*$"
        },
        "order": {
          "type": "integer",
          "minimum": 1
        },
        "title": {
          "type": "string"
        },
        "label": {
          "type": "string"
        },
        "text_blocks": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/text_block" }
        },
        "sections": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/section" }
        }
      },
      "oneOf": [
        {
          "required": ["text_blocks"],
          "not": { "required": ["sections"] }
        },
        {
          "required": ["sections"],
          "not": { "required": ["text_blocks"] }
        }
      ]
    }
  }
}
