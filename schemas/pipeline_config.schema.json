{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Pipeline Configuration Schema",
  "description": "JSON Schema for validating pipeline configuration files (YAML)",
  "type": "object",
  "required": ["steps"],
  "properties": {
    "cli_inputs": {
      "type": "array",
      "description": "CLI input specifications for interactive inputs",
      "items": {
        "type": "object",
        "required": ["label", "type"],
        "properties": {
          "label": {
            "type": "string",
            "description": "Unique label for this input",
            "minLength": 1
          },
          "type": {
            "type": "string",
            "enum": ["md", "json", "yaml", "text"],
            "description": "Input type"
          },
          "prompt": {
            "type": "string",
            "description": "Prompt to show when requesting input"
          },
          "required": {
            "type": "boolean",
            "description": "Whether this input is required",
            "default": true
          },
          "default_file": {
            "type": "string",
            "description": "Default file path to use if not provided"
          }
        },
        "additionalProperties": false
      },
      "default": []
    },
    "exogenous_inputs": {
      "type": "array",
      "description": "External inputs available to steps without being outputs of previous steps",
      "items": {
        "type": "object",
        "required": ["file", "label"],
        "properties": {
          "file": {
            "type": "string",
            "description": "Path to the external file"
          },
          "label": {
            "type": "string",
            "description": "Label to reference this input",
            "minLength": 1
          }
        },
        "additionalProperties": false
      },
      "default": []
    },
    "output_labels": {
      "type": "array",
      "description": "Registry of output labels for each step",
      "items": {
        "type": "object",
        "required": ["step", "label"],
        "properties": {
          "step": {
            "type": "string",
            "description": "Step name"
          },
          "label": {
            "type": "string",
            "description": "Output label for this step"
          }
        },
        "additionalProperties": false
      },
      "default": []
    },
    "steps": {
      "type": "object",
      "description": "Step configurations",
      "patternProperties": {
        "^[a-zA-Z_][a-zA-Z0-9_]*$": {
          "type": "object",
          "required": ["name", "prompt_file", "order"],
          "properties": {
            "name": {
              "type": "string",
              "description": "Step name"
            },
            "prompt_file": {
              "type": "string",
              "description": "Path to prompt template file"
            },
            "order": {
              "type": "integer",
              "description": "Execution order",
              "minimum": 1
            },
            "inputs": {
              "type": "array",
              "description": "Input configurations for this step",
              "items": {
                "type": "object",
                "required": ["label", "type"],
                "properties": {
                  "label": {
                    "type": "string",
                    "description": "Input label",
                    "minLength": 1
                  },
                  "type": {
                    "type": "string",
                    "enum": ["md", "json", "yaml", "text"],
                    "description": "Input type"
                  },
                  "source": {
                    "type": "string",
                    "description": "Source reference (e.g., 'cli', 'label:spec')"
                  },
                  "compression": {
                    "type": "string",
                    "enum": ["full", "anchor_index", "concept_summary", "hierarchical", "schema_only", "differential"],
                    "description": "Compression strategy to apply",
                    "default": "full"
                  },
                  "color": {
                    "type": "string",
                    "enum": ["black", "red", "green", "yellow", "blue", "magenta", "cyan", "white"],
                    "description": "Terminal color for output"
                  }
                },
                "additionalProperties": false
              },
              "default": []
            },
            "outputs": {
              "type": "array",
              "description": "Output configurations for this step",
              "items": {
                "type": "object",
                "required": ["file", "label"],
                "properties": {
                  "file": {
                    "type": "string",
                    "description": "Output file path"
                  },
                  "label": {
                    "type": "string",
                    "description": "Output label",
                    "minLength": 1
                  },
                  "type": {
                    "type": "string",
                    "enum": ["md", "json", "yaml", "text"],
                    "description": "Output type"
                  }
                },
                "additionalProperties": false
              },
              "default": []
            },
            "dependencies": {
              "type": "array",
              "description": "Step dependencies (step names)",
              "items": {
                "type": "string"
              },
              "default": []
            },
            "validation": {
              "type": "object",
              "properties": {
                "schema": {
                  "type": ["string", "null"],
                  "description": "Path to validation schema file"
                },
                "enabled": {
                  "type": "boolean",
                  "description": "Whether validation is enabled",
                  "default": false
                }
              },
              "additionalProperties": false,
              "default": {
                "schema": null,
                "enabled": false
              }
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "model_levels": {
      "type": "object",
      "description": "Model configuration for each step at different levels",
      "patternProperties": {
        "^[a-zA-Z_][a-zA-Z0-9_]*$": {
          "type": "object",
          "description": "Model configurations for a specific step",
          "additionalProperties": {
            "type": "string",
            "description": "Model identifier for this level (e.g., 1, 2, or 3)"
          }
        }
      },
      "additionalProperties": false
    },
    "dev_defaults": {
      "type": "object",
      "description": "Development default settings",
      "properties": {
        "model_level": {
          "type": "integer",
          "description": "Default model level for development",
          "minimum": 1,
          "maximum": 3,
          "default": 1
        },
        "verbosity": {
          "type": "integer",
          "description": "Default verbosity level",
          "minimum": 0,
          "maximum": 5,
          "default": 2
        },
        "skip_validation": {
          "type": "boolean",
          "description": "Whether to skip validation in development",
          "default": false
        }
      },
      "additionalProperties": false,
      "default": {
        "model_level": 1,
        "verbosity": 2,
        "skip_validation": false
      }
    }
  },
  "additionalProperties": false
}